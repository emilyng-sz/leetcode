name: Pytest Runs

on:
  push:
    branches:
      - github_actions  # Run tests on pushes to the github_actions branch to test

jobs:
  count_solutions_and_tests:
    runs-on: ubuntu-latest

    steps:
    - name: Check mismatch files in solutions/ and tests/
      run: |
        # Count files in `solutions/` and `tests/`
        solution_count=$(ls -1 ${{github.workspace}}/solutions/ | grep -v "^__" | wc -l)
        test_count=$(ls -1 ${{github.workspace}}/tests/ | grep "^test" | wc -l)

        echo "Solutions folder file count: $solution_count"
        echo "Tests folder file count: $test_count"

        # Compare counts
        if [ "$solution_count" -ne "$test_count" ]; then
          echo "::warning::Mismatch detected: Solutions ($solution_count), Tests ($test_count)"
        else
          echo "File counts match. No issues detected."
        fi

  pytest_runs:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: 3.9  # Specify Python version

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pytest

    - name: Run tests
      run: pytest tests/ 
      continue-on-error: false

    - name: Display Success Message
      if: success()
      run: echo "::notice::üéâ All tests passed successfully!"

    - name: Display Failure Message
      if: failure()
      run: echo "‚ùå Some tests failed. Please fix them before pushing."

    - name: Post Success Comment
      if: success()
      uses: actions/github-script@v6
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: "üéâ All tests passed successfully"
          })
